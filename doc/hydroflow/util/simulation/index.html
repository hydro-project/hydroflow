<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Hydroflow Deterministic Simulation Testing Framework"><title>hydroflow::util::simulation - Rust</title><script>if(window.location.protocol!=="file:")document.head.insertAdjacentHTML("beforeend","SourceSerif4-Regular-46f98efaafac5295.ttf.woff2,FiraSans-Regular-018c141bf0843ffd.woff2,FiraSans-Medium-8f9a781e4970d388.woff2,SourceCodePro-Regular-562dcc5011b6de7d.ttf.woff2,SourceCodePro-Semibold-d899c5a5c4aeb14a.ttf.woff2".split(",").map(f=>`<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../static.files/${f}">`).join(""))</script><link rel="stylesheet" href="../../../static.files/normalize-76eba96aa4d2e634.css"><link rel="stylesheet" href="../../../static.files/rustdoc-fecee23daa4e8a6d.css"><meta name="rustdoc-vars" data-root-path="../../../" data-static-root-path="../../../static.files/" data-current-crate="hydroflow" data-themes="" data-resource-suffix="" data-rustdoc-version="1.83.0-nightly (4ac7bcbaa 2024-09-04)" data-channel="nightly" data-search-js="search-a99f1315e7cc5121.js" data-settings-js="settings-4313503d2e1961c2.js" ><script src="../../../static.files/storage-118b08c4c78b968e.js"></script><script defer src="../sidebar-items.js"></script><script defer src="../../../static.files/main-921df33f47b8780c.js"></script><noscript><link rel="stylesheet" href="../../../static.files/noscript-3b12f09e550e0385.css"></noscript><link rel="alternate icon" type="image/png" href="../../../static.files/favicon-32x32-422f7d1d52889060.png"><link rel="icon" type="image/svg+xml" href="../../../static.files/favicon-2c020d218678b618.svg"></head><body class="rustdoc mod"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle" title="show sidebar"></button></nav><nav class="sidebar"><div class="sidebar-crate"><h2><a href="../../../hydroflow/index.html">hydroflow</a><span class="version">0.10.0</span></h2></div><h2 class="location"><a href="#">Module simulation</a></h2><div class="sidebar-elems"><section><ul class="block"><li><a href="#structs">Structs</a></li><li><a href="#traits">Traits</a></li><li><a href="#types">Type Aliases</a></li></ul></section><h2><a href="../index.html">In hydroflow::<wbr>util</a></h2></div></nav><div class="sidebar-resizer"></div><main><div class="width-limiter"><rustdoc-search></rustdoc-search><section id="main-content" class="content"><div class="main-heading"><h1>Module <a href="../../index.html">hydroflow</a>::<wbr><a href="../index.html">util</a>::<wbr><a class="mod" href="#">simulation</a><button id="copy-path" title="Copy item path to clipboard">Copy item path</button></h1><span class="out-of-band"><a class="src" href="../../../src/hydroflow/util/simulation.rs.html#1-440">source</a> · <button id="toggle-all-docs" title="collapse all docs">[<span>&#x2212;</span>]</button></span></div><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><h2 id="hydroflow-deterministic-simulation-testing-framework"><a class="doc-anchor" href="#hydroflow-deterministic-simulation-testing-framework">§</a>Hydroflow Deterministic Simulation Testing Framework</h2>
<p>This module provides a deterministic simulation testing framework for testing Hydroflow
transducers.</p>
<p>It can be used to test complex interactions between multiple Hydroflow transducers in a
deterministic manner by running them in a single-threaded environment. The framework also
provides a “virtual network” implementation that allows production transducers to exchange
messages within the simulation. More importantly, the network is fully under control of the
unit test and the test can introduce faults such as message delays, message drops and
network partitions.</p>
<h3 id="overview"><a class="doc-anchor" href="#overview">§</a>Overview</h3>
<p>Conceptually, the simulation contains a “Fleet”, which is a collection of “Hosts”. These
aren’t real hosts, but rather a collection of individual Hydroflow transducers (one per host)
that can communicate with each other over a virtual network. Every host has a “hostname”
which uniquely identifies it within the fleet.</p>
<div class="example-wrap"><pre class="language-text"><code> ┌───────────────────────────────────────────────────────────────────────────────────────────┐
 │SIMULATION                                                                                 │
 │ ┌───────────────────────────────────────────────────────────────────────────────────────┐ │
 │ │FLEET                                                                                  │ │
 │ │ ┌───────────────────────────────┐                   ┌───────────────────────────────┐ │ │
 │ │ │HOST                           │                   │HOST                           │ │ │
 │ │ │ ┌──────┐   ┌──────┐  ┌──────┐ │                   │ ┌──────┐   ┌──────┐  ┌──────┐ │ │ │
 │ │ │ │INBOX │   │INBOX │  │INBOX │ │                 ┌-┼-►INBOX │   │INBOX │  │INBOX │ │ │ │
 │ │ │ └──┬───┘   └──┬───┘  └──┬───┘ │                 │ │ └──┬───┘   └──┬───┘  └──┬───┘ │ │ │
 │ │ │ ┌──▼──────────▼─────────▼───┐ │                 │ │ ┌──▼──────────▼─────────▼───┐ │ │ │
 │ │ │ │                           │ │                 │ │ │                           │ │ │ │
 │ │ │ │        TRANSDUCER         │ │                 │ │ │        TRANSDUCER         │ │ │ │
 │ │ │ │                           │ │                 │ │ │                           │ │ │ │
 │ │ │ └───┬─────────┬──────────┬──┘ │                 │ │ └───┬─────────┬─────────┬───┘ │ │ │
 │ │ │  ┌──▼───┐  ┌──▼───┐  ┌───▼──┐ │                 │ │  ┌──▼───┐  ┌──▼───┐  ┌──▼───┐ │ │ │
 │ │ │  │OUTBOX│  │OUTBOX│  │OUTBOX┼-┼--┐              │ │  │OUTBOX│  │OUTBOX│  │OUTBOX│ │ │ │
 │ │ │  └──────┘  └──────┘  └──────┘ │  │              │ │  └──────┘  └──────┘  └──────┘ │ │ │
 │ │ └───────────────────────────────┘  │              │ └───────────────────────────────┘ │ │
 │ └────────────────────────────────────┼──────────────┼───────────────────────────────────┘ │
 │                                    ┌─┼──────────────┼─┐                                   │
 │                                    │ └--------------┘ │                                   │
 │                                    │ NETWORK MESSAGE  │                                   │
 │                                    │    PROCESSING    │                                   │
 │                                    └──────────────────┘                                   │
 └───────────────────────────────────────────────────────────────────────────────────────────┘
</code></pre></div><h3 id="network-processing"><a class="doc-anchor" href="#network-processing">§</a>Network Processing</h3><h4 id="outboxes--inboxes"><a class="doc-anchor" href="#outboxes--inboxes">§</a>Outboxes &amp; Inboxes</h4>
<p>When a transducer wishes to send a message to another transducer, it sends the message to an
“outbox” on its host. The unit test invokes the simulation’s network message processing logic
at some desired cadence to pick up all messages from all outboxes and deliver them to the
corresponding inboxes on the destination hosts. The network message processing logic is the
point at which failures can be injected to change the behavior of the network.</p>
<h4 id="interface-names"><a class="doc-anchor" href="#interface-names">§</a>Interface Names</h4>
<p>Every inbox and outbox is associated with an “interface name”. This is a string that uniquely
identifies the interface on the host. When a transducer sends a message, it specifies the
destination hostname and the interface name on that host to which the message should be
delivered.</p>
<h3 id="progress-of-time-in-the-simulation"><a class="doc-anchor" href="#progress-of-time-in-the-simulation">§</a>Progress of Time in the Simulation</h3>
<p>The single-threaded unit test can drive time forward on every host by invoking the <code>run_tick</code>
method on the host. This ultimately runs a single tick on the transducer. The unit test is
also responsible for invoking the network message processing at the time of its choosing and
can interleave the progress of time on various hosts and network processing as it sees fit.</p>
<h3 id="examples"><a class="doc-anchor" href="#examples">§</a>Examples</h3>
<p>Check the tests module for examples on how to use the simulation framework.</p>
</div></details><h2 id="structs" class="section-header">Structs<a href="#structs" class="anchor">§</a></h2><ul class="item-table"><li><div class="item-name"><a class="struct" href="struct.Address.html" title="struct hydroflow::util::simulation::Address">Address</a></div><div class="desc docblock-short">An address is a combination of a hostname and an interface name.</div></li><li><div class="item-name"><a class="struct" href="struct.Fleet.html" title="struct hydroflow::util::simulation::Fleet">Fleet</a></div><div class="desc docblock-short">A fleet is a collection of hosts in the simulation. It is responsible for running the
simulation and processing network messages.</div></li><li><div class="item-name"><a class="struct" href="struct.Host.html" title="struct hydroflow::util::simulation::Host">Host</a></div><div class="desc docblock-short">A host is a single Hydroflow transducer running in the simulation. It has a unique hostname
and can communicate with other hosts over the virtual network. It has a collection of inboxes
and outboxes.</div></li><li><div class="item-name"><a class="struct" href="struct.HostBuilder.html" title="struct hydroflow::util::simulation::HostBuilder">Host<wbr>Builder</a></div><div class="desc docblock-short">A builder for constructing a host in the simulation.</div></li><li><div class="item-name"><a class="struct" href="struct.Inbox.html" title="struct hydroflow::util::simulation::Inbox">Inbox</a></div><div class="desc docblock-short">An inbox is used by a host to receive messages for the transducer.</div></li><li><div class="item-name"><a class="struct" href="struct.Outbox.html" title="struct hydroflow::util::simulation::Outbox">Outbox</a></div><div class="desc docblock-short">Transducers can send messages to other transducers by putting those messages in an outbox
on their host.</div></li><li><div class="item-name"><a class="struct" href="struct.TransducerBuilderContext.html" title="struct hydroflow::util::simulation::TransducerBuilderContext">Transducer<wbr>Builder<wbr>Context</a></div><div class="desc docblock-short">Used in conjunction with the <code>HostBuilder</code> to construct a host in the simulation.</div></li></ul><h2 id="traits" class="section-header">Traits<a href="#traits" class="anchor">§</a></h2><ul class="item-table"><li><div class="item-name"><a class="trait" href="trait.MessageSender.html" title="trait hydroflow::util::simulation::MessageSender">Message<wbr>Sender</a></div><div class="desc docblock-short">A message sender is used to send messages to an inbox on a host.</div></li></ul><h2 id="types" class="section-header">Type Aliases<a href="#types" class="anchor">§</a></h2><ul class="item-table"><li><div class="item-name"><a class="type" href="type.Hostname.html" title="type hydroflow::util::simulation::Hostname">Hostname</a></div><div class="desc docblock-short">A hostname is a unique identifier for a host in the simulation. It is used to address messages
to a specific host (and thus a specific Hydroflow transducer).</div></li><li><div class="item-name"><a class="type" href="type.MessageWithAddress.html" title="type hydroflow::util::simulation::MessageWithAddress">Message<wbr>With<wbr>Address</a></div><div class="desc docblock-short">A message with an delivery address.</div></li></ul></section></div></main></body></html>