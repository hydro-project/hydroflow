<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Helper utilities for the Hydroflow surface syntax."><title>hydroflow::util - Rust</title><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/SourceSerif4-Regular-46f98efaafac5295.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/FiraSans-Regular-018c141bf0843ffd.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/FiraSans-Medium-8f9a781e4970d388.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/SourceCodePro-Regular-562dcc5011b6de7d.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/SourceCodePro-Semibold-d899c5a5c4aeb14a.ttf.woff2"><link rel="stylesheet" href="../../static.files/normalize-76eba96aa4d2e634.css"><link rel="stylesheet" href="../../static.files/rustdoc-e935ef01ae1c1829.css"><meta name="rustdoc-vars" data-root-path="../../" data-static-root-path="../../static.files/" data-current-crate="hydroflow" data-themes="" data-resource-suffix="" data-rustdoc-version="1.78.0-nightly (8f359beca 2024-02-23)" data-channel="nightly" data-search-js="search-dd67cee4cfa65049.js" data-settings-js="settings-4313503d2e1961c2.js" ><script src="../../static.files/storage-4c98445ec4002617.js"></script><script defer src="../sidebar-items.js"></script><script defer src="../../static.files/main-c37d3936c59ababd.js"></script><noscript><link rel="stylesheet" href="../../static.files/noscript-04d5337699b92874.css"></noscript><link rel="alternate icon" type="image/png" href="../../static.files/favicon-16x16-8b506e7a72182f1c.png"><link rel="alternate icon" type="image/png" href="../../static.files/favicon-32x32-422f7d1d52889060.png"><link rel="icon" type="image/svg+xml" href="../../static.files/favicon-2c020d218678b618.svg"></head><body class="rustdoc mod"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle" title="show sidebar"></button></nav><nav class="sidebar"><div class="sidebar-crate"><h2><a href="../../hydroflow/index.html">hydroflow</a><span class="version">0.5.2</span></h2></div><h2 class="location"><a href="#">Module util</a></h2><div class="sidebar-elems"><section><ul class="block"><li><a href="#modules">Modules</a></li><li><a href="#structs">Structs</a></li><li><a href="#enums">Enums</a></li><li><a href="#functions">Functions</a></li><li><a href="#types">Type Aliases</a></li></ul></section><h2><a href="../index.html">In crate hydroflow</a></h2></div></nav><div class="sidebar-resizer"></div>
    <main><div class="width-limiter"><nav class="sub"><form class="search-form"><span></span><div id="sidebar-button" tabindex="-1"><a href="../../hydroflow/all.html" title="show sidebar"></a></div><input class="search-input" name="search" aria-label="Run search in the documentation" autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"><div id="help-button" tabindex="-1"><a href="../../help.html" title="help">?</a></div><div id="settings-menu" tabindex="-1"><a href="../../settings.html" title="settings"><img width="22" height="22" alt="Change settings" src="../../static.files/wheel-7b819b6101059cd0.svg"></a></div></form></nav><section id="main-content" class="content"><div class="main-heading"><h1>Module <a href="../index.html">hydroflow</a>::<wbr><a class="mod" href="#">util</a><button id="copy-path" title="Copy item path to clipboard"><img src="../../static.files/clipboard-7571035ce49a181d.svg" width="19" height="18" alt="Copy item path"></button></h1><span class="out-of-band"><a class="src" href="../../src/hydroflow/util/mod.rs.html#1-352">source</a> · <button id="toggle-all-docs" title="collapse all docs">[<span>&#x2212;</span>]</button></span></div><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>Helper utilities for the Hydroflow surface syntax.</p>
</div></details><h2 id="modules" class="section-header">Modules<a href="#modules" class="anchor">§</a></h2><ul class="item-table"><li><div class="item-name"><a class="mod" href="clear/index.html" title="mod hydroflow::util::clear">clear</a></div><div class="desc docblock-short">Module for the <a href="clear/trait.Clear.html" title="trait hydroflow::util::clear::Clear"><code>Clear</code></a> trait.</div></li><li><div class="item-name"><a class="mod" href="cli/index.html" title="mod hydroflow::util::cli">cli</a></div></li><li><div class="item-name"><a class="mod" href="demux_enum/index.html" title="mod hydroflow::util::demux_enum">demux_enum</a></div><div class="desc docblock-short">Traits for the <code>demux_enum</code> derive and operator.</div></li><li><div class="item-name"><a class="mod" href="monotonic_map/index.html" title="mod hydroflow::util::monotonic_map">monotonic_map</a></div><div class="desc docblock-short">Module for <a href="monotonic_map/struct.MonotonicMap.html" title="struct hydroflow::util::monotonic_map::MonotonicMap"><code>MonotonicMap</code></a>.</div></li><li><div class="item-name"><a class="mod" href="multiset/index.html" title="mod hydroflow::util::multiset">multiset</a></div><div class="desc docblock-short">A multiset backed by a HashMap</div></li><li><div class="item-name"><a class="mod" href="sparse_vec/index.html" title="mod hydroflow::util::sparse_vec">sparse_vec</a></div><div class="desc docblock-short">A vector that supports efficient deletion without reordering all subsequent items.</div></li><li><div class="item-name"><a class="mod" href="unsync/index.html" title="mod hydroflow::util::unsync">unsync</a></div><div class="desc docblock-short">Unsync (i.e. single-threaded) synchronization primitives.</div></li></ul><h2 id="structs" class="section-header">Structs<a href="#structs" class="anchor">§</a></h2><ul class="item-table"><li><div class="item-name"><a class="struct" href="struct.DroppableChild.html" title="struct hydroflow::util::DroppableChild">DroppableChild</a></div><div class="desc docblock-short">When a <code>Child</code> is dropped normally nothing happens but in unit tests you usually want to terminate
the child and wait for it to terminate. <code>DroppableChild</code> does that for us.</div></li><li><div class="item-name"><a class="struct" href="struct.MonotonicFn.html" title="struct hydroflow::util::MonotonicFn">MonotonicFn</a></div><div class="desc docblock-short">A wrapper christening a closure as a <a href="https://hydro.run/docs/hydroflow/lattices_crate/lattice_math#the-calm-theorem-and-monotonicity">monotonic function</a></div></li><li><div class="item-name"><a class="struct" href="struct.Morphism.html" title="struct hydroflow::util::Morphism">Morphism</a></div><div class="desc docblock-short">A wrapper christening a closure as a <a href="https://hydro.run/docs/hydroflow/lattices_crate/lattice_math#lattice-morphism">lattice morphism</a></div></li></ul><h2 id="enums" class="section-header">Enums<a href="#enums" class="anchor">§</a></h2><ul class="item-table"><li><div class="item-name"><a class="enum" href="enum.Persistence.html" title="enum hydroflow::util::Persistence">Persistence</a></div><div class="desc docblock-short">Persit or delete tuples</div></li><li><div class="item-name"><a class="enum" href="enum.PersistenceKeyed.html" title="enum hydroflow::util::PersistenceKeyed">PersistenceKeyed</a></div><div class="desc docblock-short">Persit or delete key-value pairs</div></li></ul><h2 id="functions" class="section-header">Functions<a href="#functions" class="anchor">§</a></h2><ul class="item-table"><li><div class="item-name"><a class="fn" href="fn.bind_tcp.html" title="fn hydroflow::util::bind_tcp">bind_tcp</a></div><div class="desc docblock-short">Create a listening tcp socket, and then as new connections come in, receive their data and forward it to a queue.</div></li><li><div class="item-name"><a class="fn" href="fn.bind_tcp_bytes.html" title="fn hydroflow::util::bind_tcp_bytes">bind_tcp_bytes</a></div><div class="desc docblock-short">Returns a newline-delimited bytes <code>Sender</code>, <code>Receiver</code>, and <code>SocketAddr</code> bound to the given address.
The input <code>addr</code> may have a port of <code>0</code>, the returned <code>SocketAddr</code> will be the address of the newly bound endpoint.
The inbound connections can be used in full duplex mode. When a <code>(T, SocketAddr)</code> pair is fed to the <code>Sender</code>
returned by this function, the <code>SocketAddr</code> will be looked up against the currently existing connections.
If a match is found then the data will be sent on that connection. If no match is found then the data is silently dropped.</div></li><li><div class="item-name"><a class="fn" href="fn.bind_tcp_lines.html" title="fn hydroflow::util::bind_tcp_lines">bind_tcp_lines</a></div><div class="desc docblock-short">This is the same thing as <code>bind_tcp_bytes</code> except instead of using a length-delimited encoding scheme it uses new lines to separate frames.</div></li><li><div class="item-name"><a class="fn" href="fn.bind_udp_bytes.html" title="fn hydroflow::util::bind_udp_bytes">bind_udp_bytes</a></div><div class="desc docblock-short">Returns a length-delimited bytes <code>Sink</code>, <code>Stream</code>, and <code>SocketAddr</code> bound to the given address.
The input <code>addr</code> may have a port of <code>0</code>, the returned <code>SocketAddr</code> will have the chosen port.</div></li><li><div class="item-name"><a class="fn" href="fn.bind_udp_lines.html" title="fn hydroflow::util::bind_udp_lines">bind_udp_lines</a></div><div class="desc docblock-short">Returns a newline-delimited bytes <code>Sink</code>, <code>Stream</code>, and <code>SocketAddr</code> bound to the given address.
The input <code>addr</code> may have a port of <code>0</code>, the returned <code>SocketAddr</code> will have the chosen port.</div></li><li><div class="item-name"><a class="fn" href="fn.collect_ready.html" title="fn hydroflow::util::collect_ready">collect_ready</a></div><div class="desc docblock-short">Collects the immediately available items from the <code>Stream</code> into a <code>FromIterator</code> collection.</div></li><li><div class="item-name"><a class="fn" href="fn.collect_ready_async.html" title="fn hydroflow::util::collect_ready_async">collect_ready_async</a></div><div class="desc docblock-short">Collects the immediately available items from the <code>Stream</code> into a collection (<code>Default</code> + <code>Extend</code>).</div></li><li><div class="item-name"><a class="fn" href="fn.connect_tcp.html" title="fn hydroflow::util::connect_tcp">connect_tcp</a></div><div class="desc docblock-short">This is the inverse of bind_tcp, when messages enqueued into the returned sender, tcp sockets will be created and connected as necessary to send out the requests.
As the responses come back, they will be forwarded to the returned receiver.</div></li><li><div class="item-name"><a class="fn" href="fn.connect_tcp_bytes.html" title="fn hydroflow::util::connect_tcp_bytes">connect_tcp_bytes</a></div><div class="desc docblock-short">This is inverse of bind_tcp_bytes. <code>(Bytes, SocketAddr)</code> pairs fed to the returned <code>Sender</code> will initiate new tcp connections to the specified <code>SocketAddr</code>.
These connections will be cached and reused, so that there will only be one connection per destination endpoint. When the endpoint sends data back it will be available via the returned <code>Receiver</code></div></li><li><div class="item-name"><a class="fn" href="fn.connect_tcp_lines.html" title="fn hydroflow::util::connect_tcp_lines">connect_tcp_lines</a></div><div class="desc docblock-short">This is the same thing as <code>connect_tcp_bytes</code> except instead of using a length-delimited encoding scheme it uses new lines to separate frames.</div></li><li><div class="item-name"><a class="fn" href="fn.deserialize_from_bytes.html" title="fn hydroflow::util::deserialize_from_bytes">deserialize_from_bytes</a></div><div class="desc docblock-short">Serialize a message from bytes using bincode.</div></li><li><div class="item-name"><a class="fn" href="fn.ipv4_resolve.html" title="fn hydroflow::util::ipv4_resolve">ipv4_resolve</a></div><div class="desc docblock-short">Resolve the <code>ipv4</code> <a href="https://doc.rust-lang.org/nightly/core/net/socket_addr/enum.SocketAddr.html" title="enum core::net::socket_addr::SocketAddr"><code>SocketAddr</code></a> from an IP or hostname string.</div></li><li><div class="item-name"><a class="fn" href="fn.iter_batches_stream.html" title="fn hydroflow::util::iter_batches_stream">iter_batches_stream</a></div><div class="desc docblock-short">Returns an [<code>Stream</code>] that emits <code>n</code> items at a time from <code>iter</code> at a time, yielding in-between.
This is useful for breaking up a large iterator across several ticks: <code>source_iter(...)</code> always
releases all items in the first tick. However using <code>iter_batches_stream</code> with <code>source_stream(...)</code>
will cause <code>n</code> items to be released each tick. (Although more than that may be emitted if there
are loops in the stratum).</div></li><li><div class="item-name"><a class="fn" href="fn.ready_iter.html" title="fn hydroflow::util::ready_iter">ready_iter</a></div><div class="desc docblock-short">Returns an <a href="https://doc.rust-lang.org/nightly/core/iter/traits/iterator/trait.Iterator.html" title="trait core::iter::traits::iterator::Iterator"><code>Iterator</code></a> of any immediately available items from the [<code>Stream</code>].</div></li><li><div class="item-name"><a class="fn" href="fn.run_cargo_example.html" title="fn hydroflow::util::run_cargo_example">run_cargo_example</a></div><div class="desc docblock-short">rust examples are meant to be run by people and have a natural interface for that. This makes unit testing them cumbersome.
This function wraps calling cargo run and piping the stdin/stdout of the example to easy to handle returned objects.
The function also returns a <code>DroppableChild</code> which will ensure that the child processes will be cleaned up appropriately.</div></li><li><div class="item-name"><a class="fn" href="fn.serialize_to_bytes.html" title="fn hydroflow::util::serialize_to_bytes">serialize_to_bytes</a></div><div class="desc docblock-short">Serialize a message to bytes using bincode.</div></li><li><div class="item-name"><a class="fn" href="fn.sort_unstable_by_key_hrtb.html" title="fn hydroflow::util::sort_unstable_by_key_hrtb">sort_unstable_by_key_hrtb</a></div><div class="desc docblock-short">Sort a slice using a key fn which returns references.</div></li><li><div class="item-name"><a class="fn" href="fn.tcp_bytes.html" title="fn hydroflow::util::tcp_bytes">tcp_bytes</a></div><div class="desc docblock-short">Helper creates a TCP <code>Stream</code> and <code>Sink</code> for <code>Bytes</code> strings where each string is
length-delimited.</div></li><li><div class="item-name"><a class="fn" href="fn.tcp_bytestream.html" title="fn hydroflow::util::tcp_bytestream">tcp_bytestream</a></div><div class="desc docblock-short">Helper creates a TCP <code>Stream</code> and <code>Sink</code> for undelimited streams of <code>Bytes</code>.</div></li><li><div class="item-name"><a class="fn" href="fn.tcp_framed.html" title="fn hydroflow::util::tcp_framed">tcp_framed</a></div><div class="desc docblock-short">Helper creates a TCP <code>Stream</code> and <code>Sink</code> from the given socket, using the given <code>Codec</code> to
handle delineation between inputs/outputs.</div></li><li><div class="item-name"><a class="fn" href="fn.tcp_lines.html" title="fn hydroflow::util::tcp_lines">tcp_lines</a></div><div class="desc docblock-short">Helper creates a TCP <code>Stream</code> and <code>Sink</code> for <code>str</code>ings delimited by newlines.</div></li><li><div class="item-name"><a class="fn" href="fn.udp_bytes.html" title="fn hydroflow::util::udp_bytes">udp_bytes</a></div><div class="desc docblock-short">Helper creates a UDP <code>Stream</code> and <code>Sink</code> for <code>Bytes</code> strings where each string is
length-delimited.</div></li><li><div class="item-name"><a class="fn" href="fn.udp_bytestream.html" title="fn hydroflow::util::udp_bytestream">udp_bytestream</a></div><div class="desc docblock-short">Helper creates a UDP <code>Stream</code> and <code>Sink</code> for undelimited streams of <code>Bytes</code>.</div></li><li><div class="item-name"><a class="fn" href="fn.udp_framed.html" title="fn hydroflow::util::udp_framed">udp_framed</a></div><div class="desc docblock-short">Helper creates a UDP <code>Stream</code> and <code>Sink</code> from the given socket, using the given <code>Codec</code> to
handle delineation between inputs/outputs. Also returns the bound UdpSocket, which will be
different than the input UdpSocket if the input socket was set to port 0.</div></li><li><div class="item-name"><a class="fn" href="fn.udp_lines.html" title="fn hydroflow::util::udp_lines">udp_lines</a></div><div class="desc docblock-short">Helper creates a UDP <code>Stream</code> and <code>Sink</code> for <code>String</code>s delimited by newlines.</div></li><li><div class="item-name"><a class="fn" href="fn.unbounded_channel.html" title="fn hydroflow::util::unbounded_channel">unbounded_channel</a></div><div class="desc docblock-short">Returns a channel as a (1) unbounded sender and (2) unbounded receiver <code>Stream</code> for use in Hydroflow.</div></li><li><div class="item-name"><a class="fn" href="fn.unix_bytes.html" title="fn hydroflow::util::unix_bytes">unix_bytes</a></div><div class="desc docblock-short">Helper creates a Unix <code>Stream</code> and <code>Sink</code> for <code>Bytes</code> strings where each string is
length-delimited.</div></li><li><div class="item-name"><a class="fn" href="fn.unix_bytestream.html" title="fn hydroflow::util::unix_bytestream">unix_bytestream</a></div><div class="desc docblock-short">Helper creates a Unix <code>Stream</code> and <code>Sink</code> for undelimited streams of <code>Bytes</code>.</div></li><li><div class="item-name"><a class="fn" href="fn.unix_framed.html" title="fn hydroflow::util::unix_framed">unix_framed</a></div><div class="desc docblock-short">Helper creates a Unix <code>Stream</code> and <code>Sink</code> from the given socket, using the given <code>Codec</code> to
handle delineation between inputs/outputs.</div></li><li><div class="item-name"><a class="fn" href="fn.unix_lines.html" title="fn hydroflow::util::unix_lines">unix_lines</a></div><div class="desc docblock-short">Helper creates a Unix <code>Stream</code> and <code>Sink</code> for <code>str</code>ings delimited by newlines.</div></li><li><div class="item-name"><a class="fn" href="fn.unsync_channel.html" title="fn hydroflow::util::unsync_channel">unsync_channel</a></div><div class="desc docblock-short">Returns an unsync channel as a (1) sender and (2) receiver <code>Stream</code> for use in Hydroflow.</div></li><li><div class="item-name"><a class="fn" href="fn.wait_for_process_output.html" title="fn hydroflow::util::wait_for_process_output">wait_for_process_output</a></div><div class="desc docblock-short">When a child process is spawned often you want to wait until the child process is ready before moving on.
One way to do that synchronization is by waiting for the child process to output something and match regex against that output.
For example, you could wait until the child process outputs “Client live!” which would indicate that it is ready to receive input now on stdin.</div></li></ul><h2 id="types" class="section-header">Type Aliases<a href="#types" class="anchor">§</a></h2><ul class="item-table"><li><div class="item-name"><a class="type" href="type.TcpFramedSink.html" title="type hydroflow::util::TcpFramedSink">TcpFramedSink</a></div><div class="desc docblock-short">A framed TCP <code>Sink</code> (sending).</div></li><li><div class="item-name"><a class="type" href="type.TcpFramedStream.html" title="type hydroflow::util::TcpFramedStream">TcpFramedStream</a></div><div class="desc docblock-short">A framed TCP <code>Stream</code> (receiving).</div></li><li><div class="item-name"><a class="type" href="type.UdpBytesSink.html" title="type hydroflow::util::UdpBytesSink">UdpBytesSink</a></div><div class="desc docblock-short">A UDP undelimited bytes <code>Sink</code> (sending).</div></li><li><div class="item-name"><a class="type" href="type.UdpBytesStream.html" title="type hydroflow::util::UdpBytesStream">UdpBytesStream</a></div><div class="desc docblock-short">A UDP undelimited bytes <code>Stream</code> (receiving).</div></li><li><div class="item-name"><a class="type" href="type.UdpFramedSink.html" title="type hydroflow::util::UdpFramedSink">UdpFramedSink</a></div><div class="desc docblock-short">A framed UDP <code>Sink</code> (sending).</div></li><li><div class="item-name"><a class="type" href="type.UdpFramedStream.html" title="type hydroflow::util::UdpFramedStream">UdpFramedStream</a></div><div class="desc docblock-short">A framed UDP <code>Stream</code> (receiving).</div></li><li><div class="item-name"><a class="type" href="type.UdpLinesSink.html" title="type hydroflow::util::UdpLinesSink">UdpLinesSink</a></div><div class="desc docblock-short">A UDP newline-delimited <code>String</code> <code>Sink</code> (sending).</div></li><li><div class="item-name"><a class="type" href="type.UdpLinesStream.html" title="type hydroflow::util::UdpLinesStream">UdpLinesStream</a></div><div class="desc docblock-short">A UDP newline-delimited <code>String</code> <code>Stream</code> (receivng).</div></li><li><div class="item-name"><a class="type" href="type.UdpSink.html" title="type hydroflow::util::UdpSink">UdpSink</a></div><div class="desc docblock-short">A UDP length-delimited frame <code>Sink</code> (sending).</div></li><li><div class="item-name"><a class="type" href="type.UdpStream.html" title="type hydroflow::util::UdpStream">UdpStream</a></div><div class="desc docblock-short">A UDP length-delimited frame <code>Stream</code> (receiving).</div></li></ul></section></div></main></body></html>